<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Reporte Mensual</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            text-align: center;
        }

        .informe {
            border: 1px solid #000;
            padding: 10px;
            margin: 20px 0;
            margin-left: 15%;
            text-align: center;
        }

        .informe h2 {
            margin: 0;
        }

        .canvas-container {
            display: flex;
            justify-content: center; /* Centrar horizontalmente */
            align-items: center;
        }

        canvas {
            margin-right: 10px; /* Espacio entre los canvas */
        }

        .sidebar {
            height: 100%;
            width: 15%;
            position: fixed;
            top: 0;
            left: 0;
            background-color: #f5cbcb;
            padding-top: 20px;
            text-align: center;

        }
        .slider {
            width: 100%; /* Full-width */
            height: 25px; /* Specified height */
            
        }
        
    </style>
</head>
<body>

    <div class="sidebar">
        <div>
            <p style="text-align: center;">Consulta historicos</p>
            <p>Desde:</p><input type="date" id="fechahist">
            <p>Hasta:</p><input type="date" id="fechahistfin">
            <p></p>
            <label for="Turno"># de turno</label>
            <select id="turno" name="noturno">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            </select>  
            <p></p>
            <input type="range" min="1" max="100" value="50" class="slider" id="dateRange">
            <span id="selectedDate">Fecha seleccionada: </span>
            <div><button id="consultar">Consultar</button></div>
        </div>
    </div>

    <div class="informe">
        <h1 id="titlereporte"></h1> 
        <h2 id="titleturno" style="text-align: center;"></h2>
        <h2>PARAMETROS</h2>
        <div class="canvas-container">
            <canvas id="Disponibilidad" width="200" height="200"></canvas>
            <canvas id="Rendimiento" width="200" height="200"></canvas>
            <canvas id="Calidad" width="200" height="200"></canvas>
            <canvas id="OEE" width="225" height="225"></canvas>
        </div>
    </div>

    <div class="informe">
        <h1>Historico con turnos</h1>
        <div class="canvas-container">
            <canvas id="OEETotal" width="200" height="200"></canvas>
        </div>
        
    </div>




    <script>
        document.addEventListener('DOMContentLoaded', function () {

            function getinfort(){
                fetch('http://localhost:3000', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ startDate, endDate }),
                  })
                .then(res =>{
                return res.json();
                })
                .then(data =>{
                    console.log(data);
                    const oeePorDia = [];
                    for (let i = 0; i < data.length; i += 3) {
                    const dia = [];
                    for (let j = i; j < i + 3; j++) {
                        if (j < data.length) {
                        const turno = data[j];
                        const oee = (turno.disponibilidad * turno.rendimiento * turno.calidad) / 3;
                        dia.push(oee);
                        }
                    }
                    oeePorDia.push(dia);
                    }
                    console.log(oeePorDia);

                }).catch(error => console.log(error));

            }

            var valdisponibilidad = 20;
            var valrendimiento = 50;
            var valcalidad = 30;
            var valoee =parseInt((valrendimiento*valdisponibilidad*valcalidad)/10000);

            document.getElementById("titlereporte").innerHTML = "Reporte: " + "2023-09-25";
            document.getElementById("titleturno").innerHTML = "Turno: " + 1;

            document.getElementById("fechahist").value = "2023-09-15";
            document.getElementById("fechahistfin").value = "2023-09-26";
            document.getElementById("turno").value = 1;

            const dateRange = document.getElementById('dateRange');
            const selectedDate = document.getElementById('selectedDate');

            // Fecha inicial y final
            var startDate = new Date(Date.parse(document.getElementById("fechahist").value + "T00:00:00"));
            var endDate = new Date(Date.parse(document.getElementById("fechahistfin").value + "T00:00:00"));

            const dateDiff = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24));

            // Configura las opciones del control deslizante como fechas
            for (let i = 0; i <= dateDiff; i++) {
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + i);
                const option = document.createElement('option');
                option.value = i;
                option.textContent = currentDate.toLocaleDateString();
                dateRange.appendChild(option);
            }

            // Actualiza el texto con la fecha seleccionada
            dateRange.addEventListener('input', function () {
                const index = parseInt(dateRange.value);
                const currentDate = new Date(startDate);
                currentDate.setDate(startDate.getDate() + index);
                selectedDate.textContent = 'Fecha seleccionada: ' + currentDate.toLocaleDateString();
                document.getElementById("titlereporte").innerHTML = "Reporte: " + currentDate.toLocaleDateString();
            });

            // Establece los valores mínimo y máximo del rango
            dateRange.min = 0;
            dateRange.max = dateDiff;

            function drawPercentagedisponibilidad(chart) {
                var ctx = chart.chart.ctx;
                var width = (chart.chart.width);
                var height = (chart.chart.height)+35;
                var radius = Math.min(width, height) / 2; 
                var centerX = width / 2;
                var centerY = (height / 2);
                var fontSize = ((radius / 2).toFixed(0))-10; 
            
                var text = valdisponibilidad + "%";
            
                ctx.font = fontSize + "px sans-serif";
                ctx.fillStyle = "#000"; // Color del texto
                ctx.textBaseline = "middle";
                ctx.textAlign = "center";
            
                // posición del texto en el centro del circulo
                var textX = centerX;
                var textY = centerY;
            
                ctx.fillText(text, textX, textY);
            }
        
            function drawPercentagerendimiento(chart) {
                var ctx = chart.chart.ctx;
                var width = (chart.chart.width);
                var height = (chart.chart.height)+35;
                var radius = Math.min(width, height) / 2; 
                var centerX = width / 2;
                var centerY = (height / 2);
                var fontSize = ((radius / 2).toFixed(0))-10; 
            
                var text = valrendimiento + "%";
            
                ctx.font = fontSize + "px sans-serif";
                ctx.fillStyle = "#000"; // Color del texto
                ctx.textBaseline = "middle";
                ctx.textAlign = "center";
            
                // posición del texto en el centro del circulo
                var textX = centerX;
                var textY = centerY;
            
                ctx.fillText(text, textX, textY);
            }
                
            function drawPercentagecalidad(chart) {
                var ctx = chart.chart.ctx;
                var width = (chart.chart.width);
                var height = (chart.chart.height)+35;
                var radius = Math.min(width, height) / 2; 
                var centerX = width / 2;
                var centerY = (height / 2);
                var fontSize = ((radius / 2).toFixed(0))-10; 
            
                var text = valcalidad + "%";
            
                ctx.font = fontSize + "px sans-serif";
                ctx.fillStyle = "#000"; // Color del texto
                ctx.textBaseline = "middle";
                ctx.textAlign = "center";
            
                // posición del texto en el centro del circulo
                var textX = centerX;
                var textY = centerY;
            
                ctx.fillText(text, textX, textY);
            }
        
            function drawPercentageoee(chart) {
                var ctx = chart.chart.ctx;
                var width = (chart.chart.width);
                var height = (chart.chart.height)+35;
                var radius = Math.min(width, height) / 2; 
                var centerX = width / 2;
                var centerY = (height / 2);
                var fontSize = ((radius / 2).toFixed(0))-10; 
            
                var text = valoee + "%";
            
                ctx.font = fontSize + "px sans-serif";
                ctx.fillStyle = "#000"; // Color del texto
                ctx.textBaseline = "middle";
                ctx.textAlign = "center";
            
                // posición del texto en el centro del circulo
                var textX = centerX;
                var textY = centerY;
            
                ctx.fillText(text, textX, textY);
            }
            
            if (valdisponibilidad<=40) {
                var Disponibilidadcolor = ['#fd0100', '#e5e5e5'];
            } else if (valdisponibilidad>40 && valdisponibilidad<75) {
                var Disponibilidadcolor = ['#fffe06', '#e5e5e5'];            
            }else {
                var Disponibilidadcolor = ['#05fc03', '#e5e5e5'];
            }
    
            if (valrendimiento<=40) {
                var Rendimientocolor = ['#fd0100', '#e5e5e5'];
            } else if (valrendimiento>40 && valrendimiento<75) {
                var Rendimientocolor = ['#fffe06', '#e5e5e5'];            
            }else {
                var Rendimientocolor = ['#05fc03', '#e5e5e5'];
            }
    
            if (valcalidad<=40) {
                var Calidadcolor = ['#fd0100', '#e5e5e5'];
            } else if (valcalidad>40 && valcalidad<75) {
                var Calidadcolor = ['#fffe06', '#e5e5e5'];            
            }else {
                var Calidadcolor = ['#05fc03', '#e5e5e5'];
            }
    
            if (valoee<=40) {
                var OEEcolor = ['#fd0100', '#e5e5e5'];
            } else if (valoee>40 && valoee<75) {
                var OEEcolor = ['#fffe06', '#e5e5e5'];            
            }else {
                var OEEcolor = ['#05fc03', '#e5e5e5'];
            }


            var ctx1 = document.getElementById('Disponibilidad').getContext('2d');
            var myChart = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Disponibilidad'],
                    datasets: [{
                    data: [valdisponibilidad, 100-valdisponibilidad],
                    backgroundColor: Disponibilidadcolor,
                    }],
                },
                options: {
                    events: [],
                    responsive: false,
                    maintainAspectRatio: false,
                    tooltips: {
                        enabled: false,
                        },
                    animation: {
                        onComplete: function (chart) {
                            drawPercentagedisponibilidad(chart);
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Disponibilidad',
                            font: {weight: 'bold', size: 14},
                            color: '#2c4f63',
                        },
                        legend: {
                        display: false
                        }
                    },
        
                    borderWidth: 0,
                    cutout: 60,
                }
            });

            var ctx2 = document.getElementById('Rendimiento').getContext('2d');
            var myChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Rendimiento'],
                    datasets: [{
                    data: [valrendimiento, 100-valrendimiento],
                    backgroundColor: Rendimientocolor,
                    }],
                },
                options: {
                    events: [],
                    responsive: false,
                    maintainAspectRatio: false,
                    tooltips: {
                        enabled: false,
                        },
                    animation: {
                        onComplete: function (chart) {
                            drawPercentagerendimiento(chart);
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Rendimiento',
                            font: {weight: 'bold', size: 14},
                            color: '#2c4f63',
                        },
                        legend: {
                        display: false
                        }
                    },
        
                    borderWidth: 0,
                    cutout: 60,
                }
            });

            var ctx3 = document.getElementById('Calidad').getContext('2d');
            var myChart = new Chart(ctx3, {
                type: 'doughnut',
                data: {
                    labels: ['Calidad'],
                    datasets: [{
                    data: [valcalidad, 100-valcalidad],
                    backgroundColor: Calidadcolor,
                    }],
                },
                options: {
                    events: [],
                    responsive: false,
                    maintainAspectRatio: false,
                    tooltips: {
                        enabled: false,
                        },
                    animation: {
                        onComplete: function (chart) {
                            drawPercentagecalidad(chart);
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Calidad',
                            font: {weight: 'bold', size: 14},
                            color: '#2c4f63',
                        },
                        legend: {
                        display: false
                        }
                    },
        
                    borderWidth: 0,
                    cutout: 60,
                }
            });

            var ctx4 = document.getElementById('OEE').getContext('2d');
            var myChart = new Chart(ctx4, {
                type: 'doughnut',
                data: {
                    labels: ['OEE'],
                    datasets: [{
                    data: [valoee, 100-valoee],
                    backgroundColor: OEEcolor,
                    }],
                },
                options: {
                    events: [],
                    responsive: false,
                    maintainAspectRatio: false,
                    tooltips: {
                        enabled: false,
                        },
                    animation: {
                        onComplete: function (chart) {
                            drawPercentageoee(chart);
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'OEE',
                            font: {weight: 'bold', size: 14},
                            color: '#2c4f63',
                        },
                        legend: {
                        display: false
                        }
                    },
        
                    borderWidth: 0,
                    cutout: 70,
                }
            });
        
            var ctx5 = document.getElementById('OEETotal').getContext('2d');
            const dias = ["Día 1", "Día 2", "Día 3", "Día 4", "Día 5"];
            const turnos = ["Turno 1", "Turno 2", "Turno 3"];
            const colores = ["#FC9D9A", "#F9CDAD", "#C8C8A9"];

            const data = [
            // Día 1
            [80, 65, 75],
            // Día 2
            [75, 70, 60],
            // Día 3
            [85, 80, 90],
            // Día 4
            [70, 75, 80],
            // Día 5
            [60, 55, 65],
            ];

            const chartData = {
            labels: dias,
            datasets: turnos.map((turno, index) => ({
                label: turno,
                data: data.map((d) => d[index]),
                backgroundColor: colores[index],
                borderColor: colores[index],
                borderWidth: 3,
                pointStyle: 'circle',
                pointRadius: 4,
                pointHoverRadius: 4
            })),
            };

            const chartOptions = {
                responsive: true, // Esto permite que el gráfico se ajuste al tamaño del contenedor
                maintainAspectRatio: false,
                scales: {
                    x: {
                    stacked: false,
                    },
                    y: {
                    beginAtZero: true,
                    max: 100,
                    title: {
                        display: true,
                        text: "OEE (%)",
                    },
                    },
                },
                plugins: {
                    legend: {
                    display: true,
                    position: "top",
                    },
                },
            };

            // Crear el gráfico
            new Chart(ctx5, {
            type: "line",
            data: chartData,
            options: chartOptions,
            });

        });
    </script>

</body>
</html>
